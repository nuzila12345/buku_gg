generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String        @id @default(uuid())
  username     String        @unique
  password     String
  role         UserRole      @default(SISWA)
  nama         String
  email        String?       @unique
  alamat       String?
  telepon      String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  dendaList    Denda[]
  reviews      Review[]
  transactions Transaction[]

  @@map("users")
}

model Book {
  id           String        @id @default(uuid())
  judul        String
  penulis      String
  penerbit     String
  tahunTerbit  Int
  isbn         String?       @unique
  kategori     String
  jumlah       Int           @default(0)
  deskripsi    String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  gambar       String?
  dendaList    Denda[]
  reviews      Review[]
  transactions Transaction[]

  @@map("books")
}

model Transaction {
  id             String            @id @default(uuid())
  userId         String
  bookId         String
  tanggalPinjam  DateTime          @default(now())
  tanggalKembali DateTime?
  batasKembali   DateTime
  status         TransactionStatus @default(DIPINJAM)
  denda          Float             @default(0)
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  dendaDetail    Denda?
  book           Book              @relation(fields: [bookId], references: [id], onDelete: Cascade)
  user           User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("transactions")
}

model Denda {
  id                String         @id @default(uuid())
  transactionId     String         @unique
  userId            String
  bookId            String
  tanggalPinjam     DateTime
  tanggalJatuhTempo DateTime
  tanggalKembali    DateTime?
  jumlahHariTelat   Int            @default(0)
  dendaPerHari      Float          @default(1000)
  totalDenda        Float          @default(0)
  status            DendaStatus    @default(BELUM_DIBAYAR)
  tanggalDibayar    DateTime?
  tanggalBayar      DateTime?
  paymentMethod     PaymentMethod?
  dikonfirmasiOleh  String?
  tanggalKonfirmasi DateTime?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  book              Book           @relation(fields: [bookId], references: [id], onDelete: Cascade)
  transaction       Transaction    @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  user              User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("denda")
}

model Review {
  id        String   @id @default(uuid())
  userId    String
  bookId    String
  rating    Int      @default(5)
  ulasan    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  book      Book     @relation(fields: [bookId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, bookId])
  @@map("reviews")
}

enum UserRole {
  ADMIN
  SISWA
}

enum TransactionStatus {
  DIPINJAM
  DIKEMBALIKAN
  TERLAMBAT
}

enum DendaStatus {
  BELUM_DIBAYAR
  PENDING_KONFIRMASI
  SUDAH_DIBAYAR
}

enum PaymentMethod {
  TRANSFER
  CASH
  CARD
}
